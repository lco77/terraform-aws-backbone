{# templates/jinja-main.jinja2 #}
################################################################################
# This file is generated by "jinja.py"
################################################################################

{% for id,account in accounts.items() %} {% for region_code in account.regions %}
################################################################################
# {{ region_code }} | {{ account.name }} | {{ id }}
################################################################################

module {{ region_code }}_{{ id }} {
    for_each = {
        for k,v in local.config: v.cidr => v if (v.region == "{{ region_code }}" && v.account == "{{ id }}")
    }
    source    = "./mod_vpc/"
    providers = {
        aws.ssm = aws
        aws.vpc = aws.{{ region_code }}_{{ id }}
        aws.tgw = aws.{{ region_code }}_1234567890
        aws.r53 = aws.use1_1234567890
        }
    vpc                = each.value
    ssm                = local.ssm
    tgw                = local.tgw
    rtb                = local.rtb
    core               = local.core
    tags               = local.tags
    map_code_to_region = local.map_code_to_region
    map_region_to_code = local.map_region_to_code
    resource_prefixes  = local.map_resource_prefixes
}
{% endfor %}{% endfor %}