{# templates/jinja-main.jinja2 #}
################################################################################
# This file is generated by "jinja.py"
################################################################################

{% for id,account in accounts.items() %} {% for region_code in account.regions %}
################################################################################
# {{ region_code }} | {{ account.name }} | {{ id }}
################################################################################

module {{ region_code }}_{{ id }} {
    source    = "./mod_ssm/"
    providers = { aws = aws.{{ region_code }}_{{ id }} }
    variables = local.variables
    path      = var.ssm_path
    tags      = local.aws_tags
}

resource "aws_ssm_parameter" "{{ region_code }}_{{ id }}" {
  name        = "${var.ssm_path}/${var.repository_name}/{{ id }}/{{ region_code }}.json"
  description = "Configuration item - Do not delete !"
  type        = "String"
  tier        = "Intelligent-Tiering"
  value       = jsonencode({
    euw1  = module.{{ region_code }}_{{ id }}.output
  })
  tags        = local.aws_tags
}
{% endfor %}{% endfor %}